#include <stdio.h>
#include <stdlib.h>
#include <string.h>

extern int *comp_dd(char *pat);
extern int *comp_d(char *pat);


int bm_match(char *text, char *pat){
	int i,j;
	char *t, *p;
	int p_len, t_len;
	int offset = 0;
	int *dd, *d;
	
	p = pat;
	t = text;
	p_len = strlen(p);
	t_len = strlen(t);
	dd = comp_dd(p);
	d = comp_d(p);

	j = p_len -1;
	i = p_len -1;
	while(i <= t_len -1){
		while(p[j] != '\0' && p[j] == t[i]){
			i--;
			j--;
		}
		if(p[j] == '\0'){
			return i + 1;
		}
		else{
			offset = p_len - j + dd[j];
			i += offset > d[t[i]]?offset:d[t[i]];
			j = p_len -1;
		}
	}
	return -1;
}

int main(){
	int i = 0 ;
	char *pat = "abaabba";
	char *text = "acabaabbade";
	i = bm_match(text, pat);

	printf("%d\n",i);
}
